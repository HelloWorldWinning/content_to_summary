Timestamp: 2026-02-09T00:12:12.228686
Title: 【保姆级教程】10分钟带你用Qwen3+Dify快速造一个超强AI股票分析系统，轻松构建高效智能体，小白也能快速学会（附资料） p01 dify搭建股票分析助手 BV1JWrmBqEMx
URL: https://b23.tv/8sXD0Ex
Status: success
Duration: 22:33

Description:
**核心观点：**
通过将低代码对话流平台（DFY）与本地定制化数据服务（FastAPI）及强大的大型语言模型（LLM）相结合，可以高效构建一个具备实时股票信息获取、技术指标计算和智能投资分析能力的股票分析助手。

**总体框架：**
**“对话式AI集成与专业数据分析”** - 该框架利用对话式AI平台作为用户交互前端，通过后端定制服务处理特定领域数据（如股票信息），并结合高级AI模型进行智能分析和报告生成，从而实现特定业务流程的自动化和智能化。

---

**一、股票分析助手概览**
*   **目标：** 利用DFY构建一个股票分析助手，满足用户查询股票信息和进行详细数据分析的需求。
*   **核心功能：**
    *   获取股票实时信息（当前价格、变动等）。
    *   计算技术指标（价格走势、均线、RSI等）。
    *   提供整体趋势分析及投资建议。
*   **交互方式：** 用户输入股票代码、市场类型、时间区间，助手输出详细分析报告。

**二、本地股票分析服务搭建（Python脚本）**
*   **目的：** 获取股票信息并计算各项指标，作为DFY助手的后端数据源。
*   **技术栈：** Fast API（提供API接口）、XShare（用于股票数据查询）。
*   **部署步骤：**
    1.  **创建虚拟环境：** 使用Conda或其他工具。
    2.  **安装依赖：** `pip install -r requirements.txt` 或 `pip install fastapi uvicorn xshare`。
    3.  **启动服务：** `python Serve.py`。
*   **服务访问与测试：**
    1.  通过浏览器访问 `http://localhost:8000/docs`（FastAPI Swagger UI）。
    2.  利用Swagger UI测试接口，输入股票代码（如Apple）、市场类型，执行查询。
    3.  查看返回结果：包含当前价格、价格变动率、交易额、最高价和简单建议等。

**三、DFY对话流构建**
1.  **创建应用：** 在DFY平台创建空白应用，命名为“股票机器人”，功能描述“分析股票”。
2.  **定义用户输入节点：**
    *   **股票代码（stockCode）：** 文本输入。
    *   **市场类型（market）：** 下拉选项（A股、美股、港股、指数），非必填。
    *   **时间区间（days）：** 数字输入，默认30天，非必填。
3.  **条件分支：判断时间区间是否为空**
    *   **如果为空：** 使用会话变量（session variable）设置默认值 `days = 30`。
    *   **如果不为空：** 使用变量赋值节点将用户输入值赋给会话变量 `days`。
4.  **HTTP请求节点（访问本地服务）**
    *   **URL：** 填写本地服务的IPv4地址和端口号（例：`http://[Your_IPv4_Address]:8000/analyze_stock`）。
    *   **请求类型：** POST。
    *   **请求头：** `Accept: application/json`，`Content-Type: application/json`。
    *   **请求体（JSON）：** 引用DFY的变量和会话变量来传递参数。
        ```json
        {
          "stockCode": "{{stockCode}}",
          "market": "{{market}}",
          "days": "{{_session.days}}"
        }
        ```
5.  **异常处理：**
    *   在HTTP请求节点配置异常处理：如果请求失败，输出特定错误消息（如“您好，请检查您的输入信息内容是否正确”）。
    *   添加条件分支判断HTTP请求的返回结果是否包含该错误消息，若包含则直接回复用户错误信息。
6.  **大型语言模型（LLM）集成**
    *   **数据处理（优化方法）：** 直接将HTTP请求返回的原始`body`内容传递给一个强大的LLM（如Qwen plus latest模型）。
    *   **LLM提示词（Prompt）：** 设定角色（资深金融分析师），说明输入数据结构，要求生成详细分析报告并给出投资建议。
    *   **输出：** LLM生成完整的投资分析报告。
7.  **结束节点：** 直接回复LLM生成的分析报告文本。

**四、发布与优化**
*   **测试与发布：** 在DFY平台上进行测试，确认流程无误后发布应用。
*   **性能优化：** 针对数据提取和分析可能耗时较长的问题，优化方法是利用强大的LLM直接处理原始数据，减少中间步骤，提高效率。

---

**核心总结：**
本教程详细展示了如何通过DFY平台，结合自建的FastAPI股票数据服务和强大的大型语言模型，构建一个端到端的智能股票分析机器人，从而实现自动化、智能化的股票信息查询与投资分析。

---

<Mermaid_Diagram>
graph TD
    A["开始 Start"] --> B("用户输入: 股票信息")
    subgraph "DFY 对话流 Conversational Flow"
        B --> C{{"时间区间 'days' 为空?"}}
        C -- "是 Yes" --> D("设置默认日期: days=30")
        C -- "否 No" --> E("更新日期变量: days = 用户输入")
        D --> F("HTTP请求: 调用本地服务")
        E --> F
        F --> G{{"HTTP请求成功?"}}
        G -- "否 No" --> H("回复错误信息: '请检查输入'")
        G -- "是 Yes" --> I("数据提取与分析 (LLM)")
        I --> J("生成分析报告与投资建议")
        J --> K("结束 End")
        H --> K
    end

    subgraph "本地股票分析服务 Local Stock Analysis Service"
        subgraph "FastAPI + XShare"
            direction LR
            F -.-> L("接收请求")
            L --> M("获取股票数据")
            M --> N("计算技术指标")
            N --> O("返回结构化数据 (JSON)")
            O -.-> F
        end
    end

    style A fill:#D4EDDA,stroke:#28A745,stroke-width:2px,color:#333;
    style B fill:#E0F2F7,stroke:#3498DB,stroke-width:1px,color:#333;
    style C fill:#FFF3CD,stroke:#FFC107,stroke-width:1px,color:#333;
    style D fill:#E2F0CB,stroke:#6C757D,stroke-width:1px,color:#333;
    style E fill:#E2F0CB,stroke:#6C757D,stroke-width:1px,color:#333;
    style F fill:#F8D7DA,stroke:#DC3545,stroke-width:2px,color:#333;
    style G fill:#FFF3CD,stroke:#FFC107,stroke-width:1px,color:#333;
    style H fill:#F0AD4E,stroke:#F0AD4E,stroke-width:1px,color:#333;
    style I fill:#D1ECF1,stroke:#17A2B8,stroke-width:2px,color:#333;
    style J fill:#C3E6CB,stroke:#28A745,stroke-width:2px,color:#333;
    style K fill:#D4EDDA,stroke:#28A745,stroke-width:2px,color:#333;
    style L fill:#F2F2F2,stroke:#6C757D,stroke-width:1px,color:#333;
    style M fill:#F2F2F2,stroke:#6C757D,stroke-width:1px,color:#333;
    style N fill:#F2F2F2,stroke:#6C757D,stroke-width:1px,color:#333;
    style O fill:#F2F2F2,stroke:#6C757D,stroke-width:1px,color:#333;

    linkStyle 6 stroke-dasharray: 5 5;
    linkStyle 7 stroke-dasharray: 5 5;
    linkStyle 8 stroke-dasharray: 5 5;
    linkStyle 9 stroke-dasharray: 5 5;
</Mermaid_Diagram>

Content:
好 同时们 那么我们这节课来讲一讲就是如何用DFY来实现一个股票分析的一个助手那么想必大家平时大部分人都有查看我们股票信息以及根据这一支股票去做一个详细的数据分析的这种需求好 那么现在我们来看一下就是我们做的这种证据它能够达到一个什么样效果呢好 首先 看一下这个股票分析助手我们首先可以去给它输入一下的一个信息比如说我们需要查询的一个股票的代码还有它的一个市场类型还有它的一个时间区间比如说你想要查最近 30 天 最近 20 天那么都是可以去选择的好 那比如说股票代码比如说我们可以查一下我们的一个突发银行好 然后它的一个股市的类型是什么呢突发银行是A股好 那么时间区间默认我们实际是默认是30 天也就说我现在不填 我直接点击 Start好 那么现在我们只需要让它开始分析就行了好 开始分析好 然后我们看到它首先会给我们去列举出我们突发突发银行就是股票它最近的一个信息比如说它的一个当前价格还有它的一个价格变动然后分析时间好 然后再是技术方面的一个分析比如说它的一个价格走势它一个短期均线中期均线和长期均线等等还有它的一个相对强弱指标好 那么整体趋势好 目前的成交量以及成交额以及后续的一个投资的一个建议好 那么都会去给到我们好 那么我们直接看一下总结对吧 那么终和评计是中信建议官网的那一方向好 那么这就是我们的一个股票分析的一个住手好 那么首先大家来想一想是我们要做的这个住手它首先需要具备一个什么样的能力呢来 我们来看一下首先它需要能够获取到实实的一个信息我们当前的这是股票实实的一个状态哇 当前的价格等等信息然后它还要去获取什么呢就是它的一个计算比如说我们获取了这些信息之后我们需要在这些信息上面去做一个计算去计算这些指标对吧好 那么现在我们这一个住手呢它实在有一个非常非常核心的一个功能需要我们本地去写一个脚本那么这个脚本的目的实际上就是去获取我们的一个股票的信息并且去计算股票的一些指标好 那么首先这个脚本我在这边也是已经提前启动好了那么这段脚本我们可以看到实际上已经启动好了那么如果说大家拿到这段脚本之后应该如何去使用呢首先我们需要进入我们的一个脚本好 那么首先我们需要去创建一个虚拟环境你可以用你的扛打去创建一个扛打的环境然后执行命去安装我们的需要的一个工具包那么直接执行我们的一个批评室斗好 那么我们这里呢实际上是利用了我们的一个Fast API以及我们的XShare去做我们的一个股票的一个查询好 那么在安装好了工具包之后我们就可以直接用我们的一个排审去进行一个启动排审Serve.py好 那么在启动之后呢我们可以在我们本地本地的电脑上去看到看到我们的一个详细的信息好 那么怎么看呢首先我们的端口号端口号是80008000好 那么大家可以在自己的一个流暖器上比如说这里我们就可以直接搜索了HTTP然后在社LocalHOST然后在填写我们的一个端口号8000好 然后在写我们的一个Docrest好 那么在这里呢我们就可以看到我们有Fast API构建的这个服务好 然后我们主要看的呢就是我们的一个安装的安装的一个股票分析好 那么在这里呢实际上会给出我们一个详细的一个操作的步骤比如说我们需要输入哪些参数然后它的一个结果又是什么样子的那么大家也可以直接点击Trite Outs去进一个场势比如说什么呢比如说我们可以查查我们的一个眉骨我们的苹果好 我们直接拿过来好 查询好 然后眉骨好 眉骨好 然后我们直接点击执行好 那么可能需要等待等待一段时间好 那么现在我们就已经看到了它的一个查询结果好 那么这个股票它的一个当前的价格它的价格变动率以及它的一个交易额还有它的一个最高价以及给出我们一个比较简单的一个建议对吧好 那么这就是我们的一个服务好 那么现在服务有了之后我们就需要去Defy里面去搭建这样的一个对话流好 那么怎么搭呢首先我们来到我们Defy的一个主页里面然后直接点击创白创建我们的一个空白应用点击我们那个多门对话流然后我们给它取一个名字就是我们那个股票机器人对吧股票机器人好 那么就是分析股票好 那么在这里呢我们同样的可以给它去换一个头像好换个头像好 然后我们点击创建好 那么来到了这个页面之后我们就可以开始去做我们的一个布局好 那么首先首先我们要干什么呢首先我们需要确定我们的输入信息我们用户它输入的信息包含哪些呢首先就是我们说到的我们需要输入这个股票的一个它的一个蛋嘛 对吧好 那么我们写一下好 那就是好 然后我们还需要哪些信息呢它的一个市场它是属于A股还是眉股对吧好 那么所以在这里我们再添加一下好 那么在选择的时候呢我们可以点击我们的一个下拉选项好 那么这样的话我们就相当于是在我们是在我们是在在这里我们是在我们是在在这里我们是在那于是在做一个选择题不是填供题了我们可以直接在这里添加我们那个选项好 那么我们这个便量呢就是什么呢就是我们的market 对吧然后它就是一个股市好 那么第一个呢就是我们的一个A股好 第二个什么呢眉股好 那么第三个是什么呢杆股好 甚至我们可以看到我们除了这三个之外我还可以选什么呢我们还可以选指数对吧好 比如说我们的一个上证好 那么我们添加进来添加进来好 然后那么还有什么需要我们去添信呢好 实际上我们的一个日期我们发现我们的日期默认30天实上是一个选天的内容好 那么在这个地方呢我们就可以添加一下我们的一个dase好 那么就是日期好 那么这个呢我们就可以把B天给它去掉好 变成一个选天的内容好 那么现在下一步我们需要干什么呢好 那么下一步我们实际上就需要去做一个判断好首先 大家一定要注意的是什么呢就是我们在我们的这个符里面它实际上这个dase它实际上是必须要去输入的对吧好 但是如果说我们想要在我们的一个智能体上去做一个选天的内容的话好 那么首先我们需要去做一个判断就判断我们的这个日期到底有没有填写好 那么我们添加几点添加什么呢添加我们的一个条件分支的几点好 我们直接来做一个判断好 如果说我们的一个我们那个dase如果说它维空如果说维空好 那如果说维空的话那么我们就需要手动去进一个填写好 那么怎么去进行一个手动填写呢首先 在我们那个对话流里面实际上它有一个非常好用的功能就是我们那个会化编辆它可以直接去暴存我们给它设定的一些直比如说我们的dase它默认为30天 那么我们就可以设置一个编辆就叫做那个dase它的默认值就是我们那个30好 30好 然后我们点击啊 点击保存好 点击保存来 我们看一下好 我们选择数字好 点击保存好 然后然后我们如果说它维空的话那么我们下一步 就是干什么呢就是直接去连接到我们的一个请求上面去好 连接到我们的一个htv请求那么在这个请求里面实际上就是去访问我们刚刚看到的这个服务 它的一个网站那么现在我们把它的一个网站给输入进来好 那么一定要注意的什么呢就是我们填写的必须要是什么的必须要是我们本地本地的一个主机它的一个ipv4的一个地址ipv4的地址然后加上我们的一个端口好 那么我们的请求它的一个类型呢实际上我们也可以在这里看到是什么呢就是我们那个post请求那么点击post请求好 然后我们如果说不知道怎么点的话我们也可以直接看一下这里在这里会告诉你黑的部分是填什么东西然后 data部分是填什么内容好 那么我们直接照着它的去填写就行了比如说我们首先我们需要有一个接受的类型就是我们的一个json的类型接受类型为json然后再是什么呢再是我们的一个content我们的内容它的一个格式同样是接sign的格式通常是接sign好 然后下一步我们需要填写我们输的一个内容那么内容呢我们可以直接在接sign这一去填写我们直接把我们的一个内容给它复制进来就行了比如说我们的这一段好 接sign直接复制好 那么一定要注意我们的一个dame好 待马我们需要用便量来给它去进一个表示好 那么这个便量是哪一个呢就是我们在开始的时候输入的stalk code那么它的一个市场类型呢同样也是在开始去进一个输入的好 stalk code好 那么mockage好 那么dase呢这个地方实上我们就直接填写我们的一个环境便量就行了 环境便量的dase好 那么现在我们的这个服务 访问的服务就已经够坚好了好 那么现在大家需要来考虑一些事情了好 这是我们刚刚是如果说dase为空那我们就直接访问我们的一个环境便量因为它的默认值就是30好 那如果说我们的dase它有数字它不为空那应该怎么办呢好 那么我们这里同样填写的内容不会变对吧填写的同样是这个环境便量 会化便量好 那么我们需要做什么操作呢我们需要把它这个会化便量的值给它变化一下怎么变呢通过我们那个变量负值的一个节点好 我们在lst这把它加进来好 那么这个负值呢实上就是去改变我们的一个会化便量它的一个值把它覆盖 覆盖成什么呢就是我们的一个dase那么这样的话我们的这个逻辑就已经完成了好 那么下一步我们要干什么呢下一步我们可以去进行一个检查 对吧好 检查我们的用户的输入如果说我们用户的输入它有问题比如说我们的我们的股票带码它输错了 对吧好 那么这个时候呢它我们的post请求它可能就会反回失效了它可能会出现一些异常所以我们需要在这里去试试异常的处理在我们的htv请求接链这里我们可以去配置一下它的一个异常处理如果说发生异常的时候那么直接输出我们指定了一个内容就行了 比如说我们出错的时候就反回什么呢反回 您好您好 请检查您的输入信息 输入内容输入信息 输入内容是否正确好 那么这一步完成之后我们就可以去进行下一步了下一步如果说这个结定它失败了 它执行异常了那么我们同样也需要去写一个分支我们需要分情况去进行讨论如果说它失败了那么怎么写呢就是我们添加一下如果说这个它输出的结果里面包含我们刚刚写的这句话写的这句话 把它检查你的输入内容是否正确如果说包含这句话的话说明我们的输入内容有问题有问题有问题怎么办呢我们就可以直接回复它那么如果有问题我们就直接给它一个回复那么回复的内容就是我们的一个HV请求的一个内容那么如果说没有问题的话没有问题的话那么现在我们就需要对这些数据去进一个分析给我们去生成一个可靠的报告那么通过什么去分析呢就是通过我们的一个通过我们的模型通过我们的一个大模型去进行分析那么现在有一个问题就是我们的输出它到底是什么样子呢如果说大家想要知道它的输出是什么样子的话那么大家可以去点击点击我们的一个试园型点击试园型比如说我们输入我们要来一个蛋嘛然后输入它的一个股市日期可以不填然后开始好那么在这里我们可以看到它的一个返回的一个情况那么它实际上返回的是一个Body那么在这个在这个Body里面是上包含很多很多的一个自段那么假如说假如说现在我想干什么呢我想把这个自段里面所有的那种全部都提取出来全部都提取出来那应该怎么办呢全部都提取出来的话好首先我们全部都提取出来的话实际上我们可以利用那个大模型机点去帮我们去做那个数据的提取好 那么首先我们使用我们的一个大模型把它连接起来好 那么这个大模型呢它就是做我们的一个数据的提取好 那么怎么提呢首先我们的自段里面可能包含我们的一个什么东西呢包含我们的一个CodeNameMarket等等这些内容不然那么在这里呢在我们的模型这里我们可以去进一个设置好 就是我们的输出设置我们给大家去设置一个结构化的一个输出然后我们点击配置点击从接寸倒露好 那么我们直接把这段接寸的格式给它倒露进去就行了好 这些倒露进去好 然后点击提交好 那么这样的话它就会自动把我们伸成它需要提取的一个内容的自段好 然后我们点击保存点击保存好 那么现在呢我们就需要去写一写它的一个内容了直接提什么提取好 直接提取我们的一个HTDP里面的一个内容提取中的信息好 如我们的一个stockstockname对啊啊 并输出好 那么下一步呢下一步我们就可以去做我们的一个分析了好 那么分析的话我们也同样也可以用我们的一个大模型那么一定要注意我们使用大模型实际上我们也可以去使用一些平台上的一个大模型比如说分析件的事情呢它可能需要拆除了跟大一点的模型才能够去做得很好那么这个时候我们可以选我们千万的一个模型千万的一个plast模型plast latest我们可以选择这个模型然后然后呢我们就可以给它去试试一下我们那个体育词比如说你是一名自身的一个金融分析大师然后我们那个大模型它的结构话输出里面包含了哪些内容的数据体系output中包含了这支股票的一个详细性系然后根据这支股票性系给我们去写一份分析报告并且给出投资的一个建议就是投资分析那么最后我们就可以去做一个结束开始输入直接回复结束那么结束呢我们就直接用我们大模型的一个输出之型了直接用投资分析的text那么现在我们的工作流就已经完成了我们的工作流完成了这些多余的节点跟它伸出掉然后我们可以去点击我们那个云纳点击云纳开始分析数据体系这一部分可能会花费比较长的一个时间那么对于这种情况我们待会会给大家去介绍一种优化的一个方法首先我们来看一下它的一个分析的一个情况当前价格均线指标波动率投资建议好那么这就是我们的一个分析住手那么如何去结成我们刚刚觉得比较长了一段时间我们可以通过什么操作呢比如说我们可以直接把数据体系的模型我们直接给它先去掉先去掉我们直接把我们的一个body比较内容直接给到我们那个前问的大模型我们看看它能不能自动地去体系我们的这些信息我们可以尝试一下我们直接把htb请求的内容直接给到我们的前问然后同样的我们点击遇难开始那么我们发现呢实际上我们的前问plus latest这个模型它的能力是非常非常强大的对啊它可以直接去提取我们的一个body里面的内容并且给我们去进行一个分析直接把内容给提取出来了直接提取出来了那么如果说你是使用的一些本地的一个模型那么这个时候你可能就需要去做一个先做一个数据的体系那么这就是我们的一个股票分析的一个机器人那么大家来做完之后也可以去点击我们那个发布发布我们可以把这个几点给它杉料然后这点击发布那么希望大家在客后多去进行一个练习
