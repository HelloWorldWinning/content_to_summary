Timestamp: 2025-03-31T09:37:46.265795
Title: 【第573期】【IPV6系列】填坑篇：如何将VPS的IPV6地址段引入家庭网络，方案3：利用gre隧道，手动模拟Tunnel Broker服务，打通VPS到家庭网络，为家庭网络引入IPV6！姊妹篇！ EUoBychHOlo
URL: https://youtube.com/watch?v=EUoBychHOlo&si=0JfI8ISzscoFzfbj
Status: success
Duration: 20:04

Description:
好的，这是根据您提供的文本内容提炼的核心观点摘要和相关信息：

**核心内容摘要（大纲结构）**

1.  **回顾与目标**
    *   回顾上期内容：手动配置 SIT IPv6 隧道连接家庭网络与阿里云服务器。
    *   本期目标：尝试使用另一种隧道技术——GRE 隧道，实现相同的目的，并进行比较。

2.  **环境准备**
    *   停止并移除上一期配置的 SIT 隧道接口 (`sit1`)。
    *   检查并加载 GRE 隧道所需的内核模块 (`ip_gre`, `ip_tunnel`) 到服务端 (阿里云) 和客户端 (家庭网络机器)。

3.  **GRE 隧道配置流程 (服务端 - 阿里云)**
    *   添加 GRE 隧道接口 (`gre1`)，指定模式为 `gre`，远端为家庭网络的公网 IPv4 地址，设置 TTL。
    *   启用 (`ip link set gre1 up`) 隧道接口。
    *   为 `gre1` 接口分配 He.net 提供的 IPv6 地址作为网关地址 (例如 `...::1/64`)。

4.  **GRE 隧道配置流程 (客户端 - 家庭网络)**
    *   添加 GRE 隧道接口 (`gre1`)，指定模式为 `gre`，远端为阿里云服务器的公网 IPv4 地址，设置 TTL。
    *   为 `gre1` 接口分配 He.net 提供的 IPv6 地址作为客户端地址 (例如 `...::2/64`)。
    *   启用 (`ip link set gre1 up`) 隧道接口。
    *   添加默认 IPv6 路由，指向服务端的隧道接口地址 (`...::1`)。

5.  **隧道激活与保活**
    *   **激活**：与 SIT 隧道类似，配置完成后，需要从两端互相 `ping` 对方的隧道 IPv6 地址才能完全打通隧道。
    *   **保活**：GRE 隧道在空闲时也会中断或休眠。需要设置保活机制，例如使用 `cron` 计划任务，定期 (如每 10-30 秒) 从一端 `ping` 另一端的隧道 IPv6 地址，以维持连接活跃。

6.  **SIT 与 GRE 对比**
    *   配置流程和原理大同小异。
    *   都需要手动激活和持续保活。
    *   一个区别在于加载 GRE 模块后，可能会在系统中看到更多（3个）相关的网络接口，而 SIT 通常只增加一个。

7.  **网关功能与内网 IPv6 分配**
    *   隧道建立后，配置隧道的客户端机器（家庭网络中的 Linux）可以作为 IPv6 网关。
    *   内网其他设备可通过此网关访问 IPv6 网络。
    *   内网 IPv6 地址分配方案可以有多种：
        *   使用 He.net 分配的公网 /64 或 /48 前缀进行分配。
        *   类似 IPv4 NAT 的方式使用私有 IPv6 地址。
        *   使用公网地址段，但划分子网（如 /80 或 /64，后者需注意路由配置）。

8.  **验证**
    *   从内网设备（或配置了隧道的客户端）可以成功 `ping` 通阿里云服务端隧道地址、家庭网络客户端隧道地址以及外部 IPv6 地址（如 Google）。

**核心结论 (一句话)**

手动配置 GRE 和 SIT IPv6 隧道均可有效打通 IPv4 网络下的 IPv6 连接，但两者配置流程相似且都需要持续的保活操作来防止隧道因空闲而休眠中断。

**内容总体框架**

本文框架围绕手动配置并比较两种 IPv6 隧道技术（SIT 与 GRE），探讨其建立连接、保持活跃状态的方法，以及如何利用隧道将本地设备转变为 IPv6 网关，最终实现 IPv6 网络接入与扩展。

**Mermaid 概念图**

<Mermaid_Diagram>
graph TD
    subgraph "基础网络 (IPv4)"
        HN[家庭网络客户端 <br> (公网IPv4_A)]
        AS[阿里云服务器 <br> (公网IPv4_B)]
        IPv4_Internet[互联网 (IPv4)]
        HN -- IPv4连接 --> IPv4_Internet -- IPv4连接 --> AS
    end

    subgraph "IPv6 隧道技术"
        style SIT fill:#f9f,stroke:#333,stroke-width:2px
        style GRE fill:#ccf,stroke:#333,stroke-width:2px
        style KA fill:#FFD700,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5

        HeNet[He.net Tunnel Broker]
        IPv6Prefix[/64 或 /48 前缀]
        SIT(SIT 隧道)
        GRE(GRE 隧道)
        KA(保活机制 <br> e.g., 定期 Ping)

        HeNet -- 分配 --> IPv6Prefix
        IPv6Prefix -- 用于配置 --> SIT
        IPv6Prefix -- 用于配置 --> GRE

        KA -- 维持 --> SIT
        KA -- 维持 --> GRE
    end

    subgraph "家庭网络 (扩展IPv6)"
        style GW fill:#90EE90,stroke:#333,stroke-width:2px
        style LAN fill:#ADD8E6,stroke:#333,stroke-width:1px
        HN_TUN[客户端隧道接口 <br> (SIT1/GRE1)]
        HN_GW(客户端作网关)
        LAN_Devices[内网设备 <br> (PC, 手机等)]

        HN -- 配置 --> HN_TUN
        HN_TUN -- 实现 --> HN_GW
        HN_GW -- 提供IPv6 --> LAN_Devices
    end

    subgraph "阿里云 (服务端)"
        AS_TUN[服务端隧道接口 <br> (SIT1/GRE1)]
        AS -- 配置 --> AS_TUN
    end

    subgraph "隧道连接 (IPv6 over IPv4)"
        HN_TUN -- SIT/GRE隧道 --> AS_TUN
    end

    subgraph "IPv6 互联网访问"
        IPv6_Internet[互联网 (IPv6)]
        AS_TUN -- IPv6路由 --> IPv6_Internet
        HN_TUN -- 通过 AS_TUN --> IPv6_Internet
        LAN_Devices -- 通过 HN_GW --> HN_TUN
    end

    classDef default fill:#fff,stroke:#333,stroke-width:1px;
</Mermaid_Diagram>

Content:
大家好 欢迎来到我的频道那么在上一期咱们介绍了可以通过手动来模拟这个黑net的IPV6隧道怎么用到的是这个Sit隧道因为我们发现这个隧道本身就是在0-Sit隧道实现的那么这一期我们来试一下别的隧道因为隧道实际上是有很多种技术的那么还有一种隧道叫GRE隧道那么也可以实现类似的效果那么在这个实验之前我们先看一下上去的这个成果我们上一期我这个睡觉之前我就一直没关一直在拼这个互相拼好 像是那么我这个是家庭网络中的客户论记期我家庭网络中的客户论记期一直在这个拼对方看一下每10秒拼一次那么跑了一晚上那么一直是要是有伟用的我们看一下最后的这个位置因为它这个隧道跟这个黑纳才一官方的IPVS一样如果你这个客户论没有这个回用的话那么可能就会去修免那么我们的这个也会去修免要重新的从拼一次让它打通这个双方可见那么现在呢可以看到刚才正常还动了一下这样就动了一下那么另一个地方就是这个阿里云这一段服务端也在拼这个客户论每10秒一次也是跑了一晚上那么现在呢我可以往下看一下这个记录还不跑 还不少这个棍头查可以看出来了这跑多少了这个所以已经9000这有一大约1000来这是172000到这个位置大约是2600来看了26001下一个应该是26002那么现在还是动了那么这一切呢既然咱们用新的隧道我首先要把这个环境让给归零问一下那么我是不是现在还停着一下然后这一段也停着一下我们看一下它的这个射制这是我们上一期给配备的CIT隧道那么我们先把这个CIT隧道给停掉那么首先呢我们把它给停下来那么我们可以用这个看费个面面这个它稍打了一个F1CIT1当首先看一下那么现在呢它已经停掉了应该出于不工作状态那么现在呢我可以看一下我这个科普团的IP应该是我ISP的地址那么同时如果我们去拼这个刚刚停止的这个上游网关的话应该也是不同的那么我们再把这个AliMing呢也停着一下我先看一下网卡上一期的这个CIT1我们把它给停掉然后看一下状态那么它已经也停着的状态那么虽然它可以它已经停止了但是我们依然是可以拼通这个IPV的网络因为这个使用这个Hynet的这个IPV隧道加入的这个AliMing我们来拼一下拼一下拼一下拼一下拼一下拼一下拼一下拼一下这个下游网关肯定是拼不通的那么它已经被我给拼着了那我们去拼一下这个谷歌那么谷歌依然是通的还说我这一台机器好像没有这个进行这个保佛操作我并没有加这个角本每段时间去拼这个服务端节点但是它依然是一直会有这个想用的感觉好像是因为我这个是不是应用这个跟网IPV6啊跟有这个跟网IPV4D整好像是出于这个NAT的后面的时候需要这个保佛操作那么现在我们就去用另一条隧道那么带另一条隧道之前我们先看一下我们是有这条隧道的这个模块我们用这一个命令查看一下那么没有这个模块我们需要把这个模块给加了一起来我们来重新来看一下大家发现已经有这个模块一个用三个模块它就有一个模块好像是跟这个CIT公用的一个模块是隧道的所以我们就用这个模块这个隧道的模块这个隧道的模块这个CIT公用的一个模块是隧道的那么接下来呢我们就去这个把客户端也同样的配置一下我们的客户端我们看一下也没有这个模块我们加在一下我们角落了我经常可以说上不了这个样子上下并存在这1个 gas上下过了怎么就这样让我们要注意我们就先看 re-do我们先去加一个新的这样的隧道那么这个方式跟我们上一期比较利丝我们现在就来配置一下首先我们去添加一条隧道隧道的名字比如说我们叫吉尔伊伊指名我们的这个模式是吉尔伊隧道那么这个远端远端就填我们的这个我加听某种的iSP定制大家如果有跟我地址的话当然是最好的那么这个地方可以给它摄一个TTF比如说我用25怎么样那么下一步我们就是比如说让它上线上线呢你可以用这个命令当然也可以用这个iSP定制命令让它上线硬飞的我们的隧道是吉尔伊伊上线然后我们看一下上线透的状态那么现在呢都是默认的状态有两个私有的iPVL地址那么我们需要给它指定一个iPVL的根绑地址那么这个iPVL的根绑地址我们就按照之前的这个地址好了我们刚才这个好像拼过了拼过这个地址在哪哇这个历史翻一下那就是这个那么要断网关的好我们需要1然后我们给它加一下这个iPVL网关那么这个射位呢就是吉尔伊我们再看一下这个加之后的这个状态我们大家注意一下我刚才加的这个iP呢试一上我们可以看一下那么这个iP呢试一上就是这个上游的黑net最大根本分配的这个64亚码的这个网段然后这个黑net的客户段呢实验上是3524起那么它的这个分配的64000率呢是加13627那么整个网段都给我闷了那么现在呢我们的这个服务端应该是配着好了那么接下来呢我们去配置一下这个客户段那么客户段基本上是同样的命令我们再来一次那么首先我们去追加一个随道名字是加11这个磨射呢是加1是加11远端呢应该是我们的这个阿里云我们看一下我们的阿里云的这个iP是多少这个地方通通上一期的时候拼我把这个地址抄过来好像在这个地方也有啊之前的网卡我们只是把这个停掉并没有删掉它那么TTO呢跟服务端保持一致我们这个地方扫打了一个AID我们看一下天涯之后的这个状态因为已经有一个加11那么接下来呢我们需要给这个加11也分配一个iPv6的刚往地址那么这个刚往地址呢跟之前的这个服务端呢命率是一致的那么整过啊它的这个iP不一样而已那么我们给它是2那么现在呢还应该有一个iP了那么现在呢应该是2那么接下来呢我们让它出于这个上线的状态那么这个上线呢我们就特硬了一小不一样的面面那么加11那么现在呢我们去查看一场上这个路友因为它现在还应该没有这个iPv6的这个路友只有这个网卡的那默然还缺一条路友啊我妈这个路友给它补一下那么iPv6的默然路友呢我们也让它走这个射备加11那么这样的话我们现在呢先去拼一下这一个网关那么这个网关呢实际上就是刚才的这个iP换成1上有网关而里面的这一段那发现是没有反应的那么这一线线呢应该是跟这个之前我们用试的随道的时候是一样的线线那么我们把这个面顶带另一段来拼它客户段来试一下我们改成2我们拼一下那么发现20有反应的那么这个延程呢也大约就是七、八十的样子那我们再看另一段客户段呢现在也是有反应的那么现在这个线线跟这个应用这个C的随道来配置的时候是同样的线线那么你必须两段来互相拼一下它们把这个随道来打通那么如果你停止的的话它跪在实现之后这个随道它可能都会出于这个实效的状态那么现在是阿里服务段这个是客户段现在它不会马上实现但是过一段时间它会实现的所以也入了为了防止这种状态的出现你需要也是进行一个C的保佛比如说你去加一个精华任务每10秒如果你是这个丁美10秒它这个好像的存活的这个实验标短那么大家可以把这个时间给你认为加大一点比如说20或者是30去看一下它的存活的时间多少对你来是合适的每个人环境可能不一样你的这个值能也可能不一样我觉得这个十可能是相对来说是安全一点的10秒一次它现在你看它就已经反复了还是得需要来这一次我们让这个服务段来拼一下下游的这个Linux的这个网关然后保持活跃状态那么现在每10秒走一次那么现在呢在这一个平衡的时候它就是已经是通的了那么看一下这个地方呢每10秒走一次已经走第二次第三次那么这个位置呢应该也会一直在线的来验证它确实还在线那么这就保活操作呢实际上你只要带一段进行这一步不定时的去访问一下对面就可以了不需要去防止因为它是一个非常重要的你能不能去防止它对面就可以了不需要这一个全面两段同时这个平衡那么这个只是我给大家多展示用的两段都在拼对方你把它做成一个计划任务用这个系统的CION这个服务或者是你再估计的话你用后台的运行也是可以的比如说Sgr命令来后台运行或者是其他的一些数不见重量的后台一直走这个拼命令拼这个对面网关按我本期我们就是把上一期用的CIT随道呢换成了这个加一随道那么发现了实际上它们的这些配置都是大同小艺的又把这个流程整个走立一遍只是换成了CIT随道CIT随道比较讨厌的地方其实就是这个你加带了这个模块之后呢它这个里面会多了几个默认的接口多了三个那么CIT是多了一个它是多了三个那么实际上有点那个环境可能会有些默认的现象这个剧上往上的一些资料我看了一下如果有问题的时候你可能需要把这个加一加一零也给App的出于App的状态这个CIT随道也是如果一些莫名其妙的问题可能你也需要把它给出于这个App的状态但是我直接发现这个CIT好像并不需要至少我这边好像并不需要的我们加一身一样那么只要通过这个拼命轮就像这个随道保佛就可以了那么实际上我们之前的这个左边的这个网关走的是走的这个Henaz的App的随道也是进行保佛的我这个机箱是每分钟定期的像服务端拼一次就是抖这一个拼骨歌的这个面因为骨拼的话我出于Naz的后面它检测不到我的状态就会修免下一次要强的时候是要花时间的那这个地方就是个帅气给大家看的这个地方每一分钟会只剩一次那么这个地方上一次的真正是在这个位置是7分的时候这个是18分的时候那么通过这个命令呢基本上是可以进行保佛的我这个是它的这个日制一晚上好像产生了100多K的这个日制好像基本上没掉过线那么这个是我们CPT里面左边网关的这一台机器的保佛那么现在呢我们这个手动配置的CITUS2跟假意思的也面临了同样的问题那么既然我们把这一台机器无论你是通过SS1尺一或者是假议一或者是CITUS2把它打通了这一个两个网络之间那么阿里云跟我家庭网络那么这台Linus机器呢实际上它就已经重了一个ITV6的家庭网关跟我左边的机器一样它们都可以做网关为其它的这个机器提供网关服那么其他的机器呢不需要再去这个利用随道就足这两台网关键的任意台就可以实现这个代理上网那么这个按呢在大量善欺行给大家怎么结果实际上是有几种按的至少有四种按那么最普通的按其实就是这个因为是跟我IPV6嘛你就全部用跟我IPV6地址来分配那么用的是RSP用的这个HINET的这个IPV随道的时候因为它给你我们分配了一个新的64墙旧的网段甚至还给我们分配了一个48墙旧的我们可以用这两个前锯的网段进行这个组网那么这个呢就是整个的用的这个公网IPV6地址一或者你是谈用跟Net4一样的方式用这个Net的方式全部分配这个私有的IP也是可以的把这个蓝色的部分换掉那同时还有一些放三如果你不太喜欢的话实际上是可以把这个蓝色的这个64墙旧的网段换成同网段跟这个网关同它的网段只不过这个时候因为露有点要的问题你要把它换成这个80墙旧那么这就是放三最放三的实际上是这个最另一个方案的实际上就是这个放三的变成如果你不喜欢这个80墙旧的话实际上你也可以换成64墙旧的跟同网段64墙旧如果你的露游要非常的小心那么这个地方主要是为了考虑到有一个人用这个R1DVD服务R1DVD服务的时候你的这个SRA系无状态的这个D值弄配制的时候它需要64墙旧所以它有了这个放三的变成那么至于这个放四呢其实也就是这个利用了我们看一下放四呢实际上就是利用了它的这个48墙旧那么它跟我分配了一个前锅是48的利用它这个48墙旧你也可以进行这个族网那么这个前锅呢更短一点就更好记得我们在善于其的话善于PVT里面的话大约就是这个位置那么全部都换成48墙旧那么当然看我的这个随道的这个PGT善于就是流用的这个48墙旧的这个地方网关这个电话分配的是48墙旧那么最后我们在这个零用台底期上我们的这个PVT里面右边做实验的这个IPVL环境它是WRP来获得的这个IPVL环境我们来试一下是否可以拼通我们的这个首先我们阿里云的这个网关36那么它有两个IP一个是35那么另外一个是36我们这两个网段可以拼通我们来拼一下下游网关我们家庭网络里面打厌了这个新网关我们也是可以通的因为我到这个阿里云大概是70毫米多一点那么一个来回相当多一个来回大概是100文样子那么本期我们就是把善于其的CIT随道换成了2个随道那么基本上是同样的这个配置手法也同样的需要心保护那么本期我们就借到这儿感谢大家的收看
